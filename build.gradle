/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin library project to get you started.
 */

plugins {
    // Apply the Kotlin JVM plugin to add support for Kotlin on the JVM.
    id 'org.jetbrains.kotlin.jvm' version '1.3.31' apply false
    id 'org.springframework.boot' version '2.1.3.RELEASE' apply false
    id 'org.jetbrains.kotlin.plugin.spring' version '1.3.31' apply false
}

allprojects {
    repositories {
        // Use jcenter for resolving your dependencies.
        // You can declare any Maven/Ivy/file repository here.
        jcenter()
    }
}

subprojects {

    apply plugin: 'org.jetbrains.kotlin.jvm'

    if (name.contains('spring')) {
        apply plugin: 'org.springframework.boot'
        apply plugin: 'org.jetbrains.kotlin.plugin.spring'
        apply plugin: 'io.spring.dependency-management'
    }

    group 'com.dhenry.glia'

    dependencies {
        // Use the Kotlin JDK 8 standard library.
        implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

        // Use the Kotlin test library.
        testImplementation 'org.jetbrains.kotlin:kotlin-test'

        // Use the Kotlin JUnit integration.
        testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'

        // Awaitility
        testImplementation 'org.awaitility:awaitility-kotlin:3.1.6'

        if (name != 'glia-core') {
            implementation project(':glia-core')
        }

        if (name.contains('spring')) {
            implementation 'com.fasterxml.jackson.module:jackson-module-kotlin'
            testImplementation 'org.springframework.boot:spring-boot-starter-test'
        }

        if (name.contains('spring') && name != 'glia-spring-boot-starter-test') {
            testImplementation project(':glia-spring-boot-starter-test')
        }
    }

    compileKotlin {
        kotlinOptions {
            freeCompilerArgs = ["-Xjsr305=strict"]
            jvmTarget = "1.8"
        }
    }

    compileTestKotlin {
        kotlinOptions {
            freeCompilerArgs = ["-Xjsr305=strict"]
            jvmTarget = "1.8"
        }
    }

    task runUnitTests(type: Test) {
        description = 'Runs Unit Tests.'
        group = 'verification'

        filter {
            includeTestsMatching '*UnitTest'
        }
    }

    task runComponentTests(type: Test) {
        description = 'Runs Component Tests.'
        group = 'verification'

        filter {
            includeTestsMatching '*ComponentTest'
        }
    }

    task runIntegrationTests(type: Test) {
        description = 'Runs Integration Tests.'
        group = 'verification'

        filter {
            includeTestsMatching '*IntegrationTest'
        }
    }

}
